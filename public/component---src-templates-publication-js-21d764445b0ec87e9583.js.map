{"version":3,"file":"component---src-templates-publication-js-21d764445b0ec87e9583.js","mappings":"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","sources":["webpack://9vtbackslash5/./src/components/Product.js","webpack://9vtbackslash5/./src/templates/Publication.js"],"sourcesContent":["import React, { useContext, useEffect, useState } from \"react\";\nimport Layout from \"./Layout\";\nimport Window from \"./Window\";\nimport { GatsbyImage } from \"gatsby-plugin-image\";\nimport { ColorContext } from \"../contexts/ColorContext\";\nimport { Link } from \"gatsby\";\nimport BreadCrumbs from \"./BreadCrumbs\";\n\nconst isBrowser = typeof window !== \"undefined\";\n\nexport default function Product({\n  children,\n  src,\n  alt,\n  title,\n  description,\n  canonical,\n  additional,\n  scroller,\n  crumbs,\n}) {\n  const { color } = useContext(ColorContext);\n\n  const [path, setPath] = useState(undefined);\n  const [hash, setHash] = useState(undefined);\n\n  let _path = undefined;\n  let _hash = undefined;\n\n  if (isBrowser) {\n    _path = window.location.pathname;\n    _hash = window.location.hash;\n  }\n\n  useEffect(() => {\n    setPath(_path);\n    setHash(_hash);\n  }, [_path, _hash]);\n\n  if (hash) {\n    return (\n      <div className=\"zoom\" style={{ backgroundColor: color }}>\n        <div className=\"image\">\n          <GatsbyImage image={src} alt={alt} />\n        </div>\n        <div className=\"back\">\n          <h2>\n            <Link className=\"thick under pointer\" to={path}>\n              click here\n            </Link>{\" \"}\n            to go back to the details.\n          </h2>\n        </div>\n      </div>\n    );\n  } else {\n    return (\n      <Layout\n        page=\"catalogue\"\n        title={title}\n        description={description}\n        canonical={canonical}\n        additional={additional}\n      >\n        <main className=\"product\">\n          <Link className=\"image image-desktop pointer\" to={`${path}#zoom`}>\n            <GatsbyImage image={src} alt={alt} />\n          </Link>\n          <div className=\"product-window-wrapper\">\n            <BreadCrumbs crumbs={crumbs} className={\"small\"} />\n            <Window className=\"small\" scroller={scroller} article={true}>\n              {children}\n            </Window>\n          </div>\n        </main>\n      </Layout>\n    );\n  }\n}\n","import { graphql, Link } from \"gatsby\";\nimport { GatsbyImage, getImage } from \"gatsby-plugin-image\";\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\nimport Product from \"../components/Product\";\nimport { renderRichText } from \"gatsby-source-contentful/rich-text\";\nimport { BLOCKS, MARKS } from \"@contentful/rich-text-types\";\nimport { ColorContext } from \"../contexts/ColorContext\";\nimport { CartContext } from \"../contexts/CartContext\";\nimport moment from \"moment\";\n\nexport const query = graphql`\n  query ($slug: String!) {\n    allContentfulPublication(filter: { slug: { eq: $slug } }) {\n      nodes {\n        author\n        description {\n          raw\n        }\n        cover {\n          gatsbyImageData(placeholder: DOMINANT_COLOR)\n        }\n        slug\n        soldOut\n        releaseDate(formatString: \"MMMM YYYY\")\n        title\n        artwork\n        coverDesign\n        format\n        genre\n        pageCount\n        isbn\n        typesetting\n        price\n        shipping {\n          internal {\n            content\n          }\n        }\n        tax\n        saleEnded\n        preorder\n        preorderShipDate\n        copies\n        editors\n        shipsFrom\n        sys {\n          type\n        }\n      }\n    }\n  }\n`;\n\nconst Bold = ({ children }) => <span className=\"bold\">{children}</span>;\nconst Text = ({ children }) => <p className=\"align-center\">{children}</p>;\n\nconst options = {\n  renderMark: {\n    [MARKS.BOLD]: (text) => <Bold>{text}</Bold>,\n  },\n  renderNode: {\n    [BLOCKS.PARAGRAPH]: (node, children) => <Text>{children}</Text>,\n    [BLOCKS.EMBEDDED_ASSET]: (node) => {\n      return (\n        <>\n          <h2>Embedded Asset</h2>\n          <pre>\n            <code>{JSON.stringify(node, null, 2)}</code>\n          </pre>\n        </>\n      );\n    },\n  },\n};\n\nconst formatPrice = (amount, currency) => {\n  if ((amount && currency) || (amount === 0 && currency)) {\n    let price = (amount / 100).toFixed(2);\n    let numberFormat = new Intl.NumberFormat([\"en-US\"], {\n      style: \"currency\",\n      currency: currency,\n      currencyDisplay: \"symbol\",\n    });\n    return numberFormat.format(price);\n  }\n};\n\nexport default function Index({ data }) {\n  const publication = data?.allContentfulPublication?.nodes?.[0];\n  const description = publication?.description;\n  const cover = getImage(publication?.cover);\n\n  const { loading } = useContext(ColorContext);\n  const { addCartItems, cart } = useContext(CartContext);\n\n  const [total, setTotal] = useState(\n    publication.price + publication.price * publication.tax\n  );\n  const [subtotal, setSubtotal] = useState(publication.price);\n  const [buyerOptions, setBuyerOptions] = useState({\n    quantity: 1,\n    shipping: \"Select\",\n  });\n\n  useEffect(() => {\n    setSubtotal(publication.price * Number(buyerOptions.quantity));\n  }, [buyerOptions.quantity]);\n\n  useEffect(() => {\n    setTotal(\n      subtotal +\n        subtotal * publication.tax +\n        (buyerOptions.shipping !== \"Select\"\n          ? JSON.parse(\n              publication.shipping[Number(buyerOptions.shipping)].internal\n                .content\n            ).cost * buyerOptions.quantity\n          : 0)\n    );\n  }, [buyerOptions, subtotal, publication]);\n\n  const publicationWindow = useRef();\n\n  return (\n    <Product\n      src={cover}\n      alt={`${publication.title} cover`}\n      title={`${publication.title}, by ${publication.author}`}\n      description={`${publication.title}, by ${publication.author}. ${\n        publication.genre\n          ? `${publication.genre} published in ${publication.format}.`\n          : `published in ${publication.format}.`\n      } ${formatPrice(publication.price, \"USD\")}.`}\n      canonical={publication.slug}\n      scroller={publicationWindow}\n      crumbs={[\n        { title: \"catalogue\", slug: \"/catalogue\" },\n        { title: publication.title, slug: `/catalogue/${publication.slug}` },\n      ]}\n    >\n      {loading ? (\n        <h2 className=\"--muted loading\">(loading)</h2>\n      ) : (\n        <>\n          <div className=\"product-header\">\n            {!publication.soldOut &&\n              !publication.saleEnded &&\n              ((publication.preorder &&\n                !moment(publication.preorderShipDate).isAfter(moment())) ||\n                !moment(publication.releaseDate).isAfter(moment())) && (\n                <>\n                  {cart?.some((i) => i.slug === publication.slug) ? (\n                    <Link className=\"button disarm\" to=\"/cart\">\n                      <h4>\n                        {\n                          cart.filter((i) => i.slug === publication.slug)[0]\n                            .quantity\n                        }{\" \"}\n                        in cart\n                      </h4>\n                    </Link>\n                  ) : (\n                    <button\n                      onClick={() =>\n                        addCartItems({\n                          quantity: 1,\n                          maxQuantity: 5,\n                          slug: publication.slug,\n                          url: `/catalogue/${publication.slug}`,\n                          type: publication.sys.type,\n                          price: publication.price,\n                          tax: publication.tax,\n                          title: publication.title,\n                          author: publication.author,\n                          image: cover ? cover : undefined,\n                          shipping: publication.shipping,\n                          preorder: publication.preorder,\n                          preorderShipDate: publication.preorderShipDate,\n                        })\n                      }\n                    >\n                      <h4>add to cart</h4>\n                    </button>\n                  )}\n                </>\n              )}\n            <h1 className=\"italic title\">{publication.title}</h1>\n          </div>\n          <h2 className=\"--muted ta-right author\">by {publication.author}</h2>\n          {description && renderRichText(description, options)}\n          <div className=\"image image-mobile\">\n            <GatsbyImage image={cover} alt={`${publication.title} cover`} />\n          </div>\n          {publication.copies && (\n            <h2 className=\"--muted\">\n              this edition is limited to {publication.copies} copies.\n            </h2>\n          )}\n          <h1>details</h1>\n          {publication.editors && (\n            <h2 className=\"m-0\">edited by {publication.editors}</h2>\n          )}\n          {publication.typesetting && (\n            <h2 className=\"m-0\">typesetting by {publication.typesetting}</h2>\n          )}\n          {publication.coverDesign && (\n            <h2 className=\"m-0\">cover design by {publication.coverDesign}</h2>\n          )}\n          {publication.artwork && (\n            <h2 className=\"m-0\">artwork by {publication.artwork}</h2>\n          )}\n          {publication.publisher && (\n            <h2 className=\"m-0\">printed by {publication.publisher}</h2>\n          )}\n          {publication.releaseDate && (\n            <h2 className=\"m-0\">published in {publication.releaseDate}</h2>\n          )}\n          {publication.genre && <h2 className=\"m-0\">{publication.genre}</h2>}\n          {publication.format && <h2 className=\"m-0\">{publication.format}</h2>}\n          {publication.pageCount && (\n            <h2 className=\"m-0\">{publication.pageCount} pages</h2>\n          )}\n          {publication.isbn && (\n            <h2 className=\"m-0\">ISBN: {publication.isbn}</h2>\n          )}\n          {publication.price && (\n            <h2 className=\"m-0\">{formatPrice(publication.price, \"USD\")}</h2>\n          )}\n          {publication.copies && (\n            <h2 className=\"m-0\">limited to {publication.copies} copies</h2>\n          )}\n          {publication.soldOut && (\n            <h2 className=\"m-0 --muted\">this publication is sold out</h2>\n          )}\n          {publication.saleEnded && (\n            <h2 className=\"m-0 --muted\">\n              sales for this publication have ended\n            </h2>\n          )}\n          <h2 className=\"ta-right\">\n            <Link to=\"/catalogue\">click here</Link> to navigate back to our\n            catalogue.\n          </h2>\n        </>\n      )}\n    </Product>\n  );\n}\n"],"names":["isBrowser","window","Product","_ref","children","src","alt","title","description","canonical","additional","scroller","crumbs","color","useContext","ColorContext","_useState","useState","undefined","path","setPath","_useState2","hash","setHash","_path","_hash","location","pathname","useEffect","React","className","style","backgroundColor","GatsbyImage","image","Link","to","Layout","page","BreadCrumbs","Window","article","Bold","Text","_ref2","options","renderMark","_renderMark","MARKS","text","renderNode","_renderNode","BLOCKS","node","JSON","stringify","formatPrice","amount","currency","price","toFixed","Intl","NumberFormat","currencyDisplay","format","Index","_ref3","_data$allContentfulPu","_data$allContentfulPu2","data","publication","allContentfulPublication","nodes","cover","getImage","loading","_useContext2","CartContext","addCartItems","cart","tax","setTotal","subtotal","setSubtotal","_useState3","quantity","shipping","buyerOptions","Number","parse","internal","content","cost","publicationWindow","useRef","author","genre","slug","soldOut","saleEnded","preorder","moment","preorderShipDate","isAfter","releaseDate","some","i","filter","onClick","maxQuantity","url","type","sys","renderRichText","copies","editors","typesetting","coverDesign","artwork","publisher","pageCount","isbn"],"sourceRoot":""}