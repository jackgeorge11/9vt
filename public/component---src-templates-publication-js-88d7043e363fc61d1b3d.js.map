{"version":3,"file":"component---src-templates-publication-js-88d7043e363fc61d1b3d.js","mappings":"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","sources":["webpack://9vtbackslash5/./src/components/Product.js","webpack://9vtbackslash5/./src/templates/Publication.js"],"sourcesContent":["import React, { useContext, useEffect, useState } from \"react\";\nimport Layout from \"./Layout\";\nimport Window from \"./Window\";\nimport { GatsbyImage, StaticImage } from \"gatsby-plugin-image\";\nimport { ColorContext } from \"../contexts/ColorContext\";\nimport { Link } from \"gatsby\";\nimport BreadCrumbs from \"./BreadCrumbs\";\n\nconst isBrowser = typeof window !== \"undefined\";\n\nexport default function Product({\n  children,\n  src,\n  alt,\n  title,\n  description,\n  canonical,\n  additional,\n  scroller,\n  crumbs,\n}) {\n  const { color } = useContext(ColorContext);\n\n  const [path, setPath] = useState(undefined);\n  const [hash, setHash] = useState(undefined);\n\n  let _path = undefined;\n  let _hash = undefined;\n\n  if (isBrowser) {\n    _path = window.location.pathname;\n    _hash = window.location.hash;\n  }\n\n  useEffect(() => {\n    setPath(_path);\n    setHash(_hash);\n  }, [_path, _hash]);\n\n  if (hash) {\n    return (\n      <div className=\"zoom\" style={{ backgroundColor: color }}>\n        <div className=\"image\">\n          <GatsbyImage image={src} alt={alt} />\n        </div>\n        <div className=\"back\">\n          <h2>\n            <Link className=\"thick under pointer\" to={path}>\n              click here\n            </Link>{\" \"}\n            to go back to the details.\n          </h2>\n        </div>\n      </div>\n    );\n  } else {\n    return (\n      <Layout\n        page=\"catalogue\"\n        title={title}\n        description={description}\n        canonical={canonical}\n        additional={additional}\n      >\n        <main className=\"product\">\n          <Link className=\"image image-desktop pointer\" to={`${path}#zoom`}>\n            <GatsbyImage image={src} alt={alt} />\n          </Link>\n          <div className=\"product-window-wrapper\">\n            <BreadCrumbs crumbs={crumbs} className={\"small\"} />\n            <Window className=\"small\" scroller={scroller} article={true}>\n              {children}\n            </Window>\n          </div>\n        </main>\n      </Layout>\n    );\n  }\n}\n","import { graphql, Link } from \"gatsby\";\nimport { GatsbyImage, getImage } from \"gatsby-plugin-image\";\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\nimport Product from \"../components/Product\";\nimport { renderRichText } from \"gatsby-source-contentful/rich-text\";\nimport { BLOCKS, MARKS } from \"@contentful/rich-text-types\";\nimport { ColorContext } from \"../contexts/ColorContext\";\nimport { CartContext } from \"../contexts/CartContext\";\nimport moment from \"moment\";\n\nexport const query = graphql`\n  query ($slug: String!) {\n    allContentfulPublication(filter: { slug: { eq: $slug } }) {\n      nodes {\n        author\n        description {\n          raw\n        }\n        cover {\n          gatsbyImageData(placeholder: DOMINANT_COLOR)\n        }\n        slug\n        soldOut\n        releaseDate(formatString: \"MMMM YYYY\")\n        title\n        artwork\n        coverDesign\n        format\n        genre\n        pageCount\n        isbn\n        typesetting\n        price\n        shipping {\n          internal {\n            content\n          }\n        }\n        tax\n        saleEnded\n        preorder\n        preorderShipDate\n        copies\n        editors\n        shipsFrom\n        sys {\n          type\n        }\n      }\n    }\n  }\n`;\n\nconst Bold = ({ children }) => <span className=\"bold\">{children}</span>;\nconst Text = ({ children }) => <p className=\"align-center\">{children}</p>;\n\nconst options = {\n  renderMark: {\n    [MARKS.BOLD]: (text) => <Bold>{text}</Bold>,\n  },\n  renderNode: {\n    [BLOCKS.PARAGRAPH]: (node, children) => <Text>{children}</Text>,\n    [BLOCKS.EMBEDDED_ASSET]: (node) => {\n      return (\n        <>\n          <h2>Embedded Asset</h2>\n          <pre>\n            <code>{JSON.stringify(node, null, 2)}</code>\n          </pre>\n        </>\n      );\n    },\n  },\n};\n\nconst formatPrice = (amount, currency) => {\n  if ((amount && currency) || (amount === 0 && currency)) {\n    let price = (amount / 100).toFixed(2);\n    let numberFormat = new Intl.NumberFormat([\"en-US\"], {\n      style: \"currency\",\n      currency: currency,\n      currencyDisplay: \"symbol\",\n    });\n    return numberFormat.format(price);\n  }\n};\n\nexport default function Index({ data }) {\n  const publication = data?.allContentfulPublication?.nodes?.[0];\n  const description = publication?.description;\n  const cover = getImage(publication?.cover);\n\n  const { loading } = useContext(ColorContext);\n  const { addCartItems, cart } = useContext(CartContext);\n\n  const [total, setTotal] = useState(\n    publication.price + publication.price * publication.tax\n  );\n  const [subtotal, setSubtotal] = useState(publication.price);\n  const [buyerOptions, setBuyerOptions] = useState({\n    quantity: 1,\n    shipping: \"Select\",\n  });\n\n  useEffect(() => {\n    setSubtotal(publication.price * Number(buyerOptions.quantity));\n  }, [buyerOptions.quantity]);\n\n  useEffect(() => {\n    setTotal(\n      subtotal +\n        subtotal * publication.tax +\n        (buyerOptions.shipping !== \"Select\"\n          ? JSON.parse(\n              publication.shipping[Number(buyerOptions.shipping)].internal\n                .content\n            ).cost * buyerOptions.quantity\n          : 0)\n    );\n  }, [buyerOptions.shipping, subtotal]);\n\n  const publicationWindow = useRef();\n\n  return (\n    <Product\n      src={cover}\n      alt={`${publication.title} cover`}\n      title={`${publication.title}, by ${publication.author}`}\n      description={`${publication.title}, by ${publication.author}. ${\n        publication.genre\n          ? `${publication.genre} published in ${publication.format}.`\n          : `published in ${publication.format}.`\n      } ${formatPrice(publication.price, \"USD\")}.`}\n      canonical={publication.slug}\n      scroller={publicationWindow}\n      crumbs={[\n        { title: \"catalogue\", slug: \"/catalogue\" },\n        { title: publication.title, slug: `/catalogue/${publication.slug}` },\n      ]}\n    >\n      {loading ? (\n        <h2 className=\"--muted loading\">(loading)</h2>\n      ) : (\n        <>\n          <div className=\"product-header\">\n            {!publication.soldOut &&\n              !publication.saleEnded &&\n              ((publication.preorder &&\n                !moment(publication.preorderShipDate).isAfter(moment())) ||\n                !moment(publication.releaseDate).isAfter(moment())) && (\n                <>\n                  {cart?.some((i) => i.slug === publication.slug) ? (\n                    <Link className=\"button disarm\" to=\"/cart\">\n                      <h4>\n                        {\n                          cart.filter((i) => i.slug === publication.slug)[0]\n                            .quantity\n                        }{\" \"}\n                        in cart\n                      </h4>\n                    </Link>\n                  ) : (\n                    <button\n                      onClick={() =>\n                        addCartItems({\n                          quantity: 1,\n                          maxQuantity: 5,\n                          slug: publication.slug,\n                          url: `/catalogue/${publication.slug}`,\n                          type: publication.sys.type,\n                          price: publication.price,\n                          tax: publication.tax,\n                          title: publication.title,\n                          author: publication.author,\n                          image: cover ? cover : undefined,\n                          shipping: publication.shipping,\n                          preorder: publication.preorder,\n                          preorderShipDate: publication.preorderShipDate,\n                        })\n                      }\n                    >\n                      <h4>add to cart</h4>\n                    </button>\n                  )}\n                </>\n              )}\n            <h1 className=\"italic title\">{publication.title}</h1>\n          </div>\n          <h2 className=\"--muted ta-right author\">by {publication.author}</h2>\n          {description && renderRichText(description, options)}\n          <div className=\"image image-mobile\">\n            <GatsbyImage image={cover} alt={`${publication.title} cover`} />\n          </div>\n          {publication.copies && (\n            <h2 className=\"--muted\">\n              this edition is limited to {publication.copies} copies.\n            </h2>\n          )}\n          <h1>details</h1>\n          {publication.editors && (\n            <h2 className=\"m-0\">edited by {publication.editors}</h2>\n          )}\n          {publication.typesetting && (\n            <h2 className=\"m-0\">typesetting by {publication.typesetting}</h2>\n          )}\n          {publication.coverDesign && (\n            <h2 className=\"m-0\">cover design by {publication.coverDesign}</h2>\n          )}\n          {publication.artwork && (\n            <h2 className=\"m-0\">artwork by {publication.artwork}</h2>\n          )}\n          {publication.publisher && (\n            <h2 className=\"m-0\">printed by {publication.publisher}</h2>\n          )}\n          {publication.releaseDate && (\n            <h2 className=\"m-0\">published in {publication.releaseDate}</h2>\n          )}\n          {publication.genre && <h2 className=\"m-0\">{publication.genre}</h2>}\n          {publication.format && <h2 className=\"m-0\">{publication.format}</h2>}\n          {publication.pageCount && (\n            <h2 className=\"m-0\">{publication.pageCount} pages</h2>\n          )}\n          {publication.isbn && (\n            <h2 className=\"m-0\">ISBN: {publication.isbn}</h2>\n          )}\n          {publication.price && (\n            <h2 className=\"m-0\">{formatPrice(publication.price, \"USD\")}</h2>\n          )}\n          {publication.copies && (\n            <h2 className=\"m-0\">limited to {publication.copies} copies</h2>\n          )}\n          {publication.soldOut && (\n            <h2 className=\"m-0 --muted\">this publication is sold out</h2>\n          )}\n          {publication.saleEnded && (\n            <h2 className=\"m-0 --muted\">\n              sales for this publication have ended\n            </h2>\n          )}\n          <h2 className=\"ta-right\">\n            <Link to=\"/catalogue\">click here</Link> to navigate back to our\n            catalogue.\n          </h2>\n        </>\n      )}\n    </Product>\n  );\n}\n"],"names":["isBrowser","window","Product","children","src","alt","title","description","canonical","additional","scroller","crumbs","color","useContext","ColorContext","useState","undefined","path","setPath","hash","setHash","_path","_hash","location","pathname","useEffect","className","style","backgroundColor","G","image","Link","to","page","article","Bold","Text","options","renderMark","MARKS","text","renderNode","BLOCKS","node","JSON","stringify","formatPrice","amount","currency","price","toFixed","Intl","NumberFormat","currencyDisplay","format","Index","data","publication","allContentfulPublication","nodes","cover","getImage","loading","CartContext","addCartItems","cart","tax","setTotal","subtotal","setSubtotal","quantity","shipping","buyerOptions","Number","parse","internal","content","cost","publicationWindow","useRef","author","genre","slug","soldOut","saleEnded","preorder","moment","preorderShipDate","isAfter","releaseDate","some","i","filter","onClick","maxQuantity","url","type","sys","renderRichText","copies","editors","typesetting","coverDesign","artwork","publisher","pageCount","isbn"],"sourceRoot":""}